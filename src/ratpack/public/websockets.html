<!DOCTYPE html>
<html>
<head>

</head>
<body>

<h1>Ratpack Websockets</h1>


<script>
  function connectWs() {
    if (!window.ws || window.ws.readyState != WebSocket.OPEN) {
      window.ws = new WebSocket("ws://"+location.host+"/ws");

      window.ws.onopen = function(event) {
        console.log("WebSocket opened!");
      };
      window.ws.onmessage = function(event) {
        var div = document.createElement("div");
        div.innerHTML = event.data;
        document.body.appendChild(div);
      };
      window.ws.onclose = function(event) {
        var timer = setTimeout(function() {
          console.log("Retrying connection...");
          connectWs();
          if (window.ws.readyState == WebSocket.OPEN) {
            clearTimeout(timer);
          }
        }, 1000);
      };
    }
  }

  connectWs();
</script>
</body>
</html>